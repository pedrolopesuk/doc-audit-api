// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Establishment {
  id         String     @id @default(uuid())
  name       String
  cnpj       String     @unique
  address    String
  documents  Document[] // 1:N relationship
}

model Document {
  id               String        @id @default(uuid())
  name             String
  type             DocumentType
  description      String?
  number           String?
  issueDate        DateTime
  expirationDate   DateTime
  issueFee         String
  establishment    Establishment @relation(fields: [establishmentId], references: [id])
  establishmentId  String

  dependencies     Dependency[]  @relation("Dependent")
  requirements     Dependency[]  @relation("Requirement") // <-- ADICIONAR ISSO
}


model Dependency {
  id             String   @id @default(uuid())
  document       Document @relation("Dependent", fields: [documentId], references: [id])
  documentId     String

  dependsOn      Document @relation("Requirement", fields: [dependsOnId], references: [id])
  dependsOnId    String

  type           String

  @@unique([documentId, dependsOnId])
}

enum DocumentType {
  BUSINESS_LICENSE
  TAX_REGISTRATION
  CNPJ_REGISTRATION
  OPERATING_PERMIT
  FIRE_DEPARTMENT_CERTIFICATE
  HEALTH_LICENSE
  TRADE_BOARD_REGISTRATION
  COMPANY_ARTICLES
  INSS_CERTIFICATE
  LABOR_CERTIFICATE
  FGTS_CERTIFICATE
  MUNICIPAL_DEBT_CLEARANCE
  FEDERAL_DEBT_CLEARANCE
  ENVIRONMENTAL_LICENSE
}